#!/bin/bash

if [ $# -lt 1 ];then
	echo0 1 $0" in.bed2|\"in1.bed2 in2.bed2...\" normalization_factor minimal_length maximal_length"
	exit 1
fi

factor=$2

if [ "${1% *}" == "$1" ];then
	awk -v factor=$factor -v mi=$3 -v ma=$4 'BEGIN{FS=OFS="\t"} {l[length($7)]+=$4/$5} END{for(i=mi;i<=ma;i++){print i,l[i]/factor}}' $1
else
	fn=""
	for i in $1
	do
		awk -v factor=$factor -v mi=$3 -v ma=$4 'BEGIN{FS=OFS="\t"} {l[length($7)]+=$4/$5} END{for(i=mi;i<=ma;i++){print l[i]/factor}}' $i > temp.${i}
		fn=$fn" temp."$i
	done
	awk 'BEGIN{for(i=15;i<=35;i++){print i}}' > temp.head
	paste temp.head $fn
	rm $fn
fi

